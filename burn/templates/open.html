{% extends "layout.html" %}
{% block body %}
<form ng-controller="OpenCtl">
  {% if unique_visitors > 2 %}
    <div class="msg warning flash">
      Someone else may have accessed this message before you! Check the visitor log below.
    </div>
  {% endif %}
  {% raw %}
  <div id="statusbox" ng-show="status" class="msg {{status}}">
    {{reason}}
  </div>
  {% endraw %}

  <div>
    <input type="hidden" id="themessage" value="{{msg|e}}">
    <input type="hidden" id="expiry" value="{{expiry}}">

    <div ng-show="decrypted_succesfully">
      {% raw %}
      <label for="message">Message</label>
      <textarea class="u-full-width" id="thebox" name="message" rows="6" readonly>{{decrypted}}</textarea>

      <div ng-hide="burned">
        <p>Once you've read the message, press "burn" to delete it from the server. It will expire automatically {{expiry}}</p>
        <button class="button-burn" ng-click="burn()">burn</button>
      </div>
      {% endraw %}
    </div>

    <div ng-hide="decrypted_succesfully" ng-hide="status">
      <label for="password">Password</label>
      <input type="text" ng-model="password" placeholder="" name="password">
      <button ng-click="attempt_decrypt()">decrypt</button>
    </div>

  </div>

  <div class="visitor_box">
    <b>Visitors</b>
    <p>{{unique_visitors}} unique IP-address{% if unique_visitors > 1 %}es have{% else %} has{% endif %} visited this page. The table below shows every visit that fetched the encrypted message.
      This means they knew the unique identifier, but it does not necessarily mean they had the password to decrypt.  {% if anonymous %} IP addresses are anonymized by use of a hash function. {% endif %}
     </p>
    <table class="u-full-width">
      <thead>
        <tr><td>Visitor</td><td>Time</td></tr>
      </thead>
      <tbody>
      {% for v in visitors %}
        <tr>
          <td>{{v[0]}}</td>
          <td>{{v[1]}}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</form>


{% endblock %}
